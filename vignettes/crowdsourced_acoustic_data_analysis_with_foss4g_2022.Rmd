---
title: "Crowdsourced acoustic open data analysis with FOSS4G tools"
pkgdown:
  as_is: true
output:
  bookdown::html_document2
  
vignette: >
  %\VignetteIndexEntry{Crowdsourced acoustic open data analysis with FOSS4G tools}
  %\VignetteEngine{rmarkdown::render}
  %\VignetteEncoding{UTF-8}
author:
- name: Nicolas Roelandt
  affiliation: AME, Univ. Gustave Eiffel, IFSTTAR, F-69675 Bron, France
- name: Pierre Aumond
  affiliation: UMRAE, Univ Gustave Eiffel, IFSTTAR, CEREMA, F-44344 Bouguenais, France
- name: Ludovic Moisan
  affiliation: UMRAE, Univ Gustave Eiffel, IFSTTAR, CEREMA, F-44344 Bouguenais, France
bibliography: bibliography.bib
biblio-style: "apalike"
link-citations: true
date: "`r Sys.Date()`"
figures:
  dpi: 72
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE
)
```

```{r comments, include=FALSE}
#' Call for paper : https://2022.foss4g.org/cfp-academic_track.php
#' Submission of academic abstracts 	from 06/12/2021 	to 28/02/2022
#' Announcement of accepted abstracts 		01/04/2022
#' Submission of full academic papers 		01/06/2022
```

# Keywords {-}
Environmental acoustics, crowdsourced open data, FOSS4G, reproducibility,
literate programming, Open Science, 
Open Geospatial Software, Open GIScience, Open Geospatial Data 

# Abstract {-}
<!--TODO modifier l'abstract en évitant de copier coller l'intro -->

[NoiseCapture](https://noise-planet.org/noisecapture.html) is a Android application 
developed by the [Gustave Eiffel University](https://www.univ-gustave-eiffel.fr/)
and the [French National Centre for Scientific Research](https://www.cnrs.fr/en/cnrs) 
as central element of a participatory approach to environmental noise mapping.
The application is open-source, and all its data are available freely.

This study presents the results of the first exploratory analysis of 3 years of 
data collection through the lens of sound sources.

Sound dynamics of roads related to commuting or bird songs have been observed. 
The first results are therefore encouraging. 
This analysis is based only on the tags given by the users and not on the sound 
spectrum of the measurement, which will be studied at a later stage. 

As this preparatory work will be consolidated and extended later, and with the will
to register this study in the framework of the Open Science, we paid attention 
to its reproducibility. 

The context of the study, the tools and techniques used and the first results 
obtained will be presented as well as the benefits of using literate programming 
in this type of preparatory work.


# Introduction {-}

NoiseCapture[^1] is an Android application developed by the Gustave Eiffel University[^2] 
and the CNRS[^3] as part of a participatory approach to environmental noise mapping. 
The application is open-source and all collected data are available under an Open Database License.

[^1]: https://noise-planet.org/noisecapture.html
[^2]: https://www.univ-gustave-eiffel.fr/en/
[^3]: https://www.cnrs.fr/en

The study presented here is the first exploratory analysis of the first three years of data 
collection, through the prism of noise sources. The analysis only focused on the 
labels filled in by the users and not on the sound spectrum of the recordings, 
which will be studied later.

The aim was to determine whether known dynamics in environmental acoustics could
be recovered using collaborative data.

As these first exploratory works will be extended and consolidated thereafter, and with 
the will to include this study within the framework of the Open Science, an 
attention was brought on the reproducibility aspect of the analysis. 
It was entirely realized with free software and literate programming techniques.

The context of the study, the implemented methodology and the first results 
will be presented as well as the benefits of using literate programming 
in this type of exploratory work.

# Context

<!-- Présentation de l'acoustique environnementale et du projet NoiseCapture -->

The beginining of this analysis was the release of a 3 years collection of environnemental
acoustic samples. A first article presenting this dataset has been published in 2021 [@picautSmartphoneBasedCrowdSourcedDatabase2021].

It details the structure of the database and the data, the profile of the 
contributors and the contributions but does not analyze the content of the data. 
This is what this article proposes to begin.

## Methodology

As the NoiseCapture application is Open Source and the data collection infrastructure 
use Free and Open Source Softwares (FOSS), we decided to pursue this by using 
open source software and data for analysis part.

First, we will introduce the dataset then we will present the tools we used and why we choose them.

### Data

The data used in this study are contributions made by the user of the application
between August 29, 2017 and August 28, 2020.
During this period, nearly 70,000 unique contributors allowed 
the collection of more than 260,000 tracks for a total of about 60 million seconds 
of measurement. A track (or *trace*) is a collected recording, it contains the 
record of the sound spectrum (1 second, third octave) recorded by the phone microphone 
coupled with its GPS positioning (1 second). Each track is timestamped too.

The 3 years collection dataset is available with an Open Database License through
the Gustave Eiffel university Dataverse[^4].

[^4]: https://research-data.ifsttar.fr/dataset.xhtml?persistentId=doi:10.25578/J5DG3W


This information can be enriched by the contributor with labels. 
There are 18 predefined labels and the user can select one or more of them for each of the 
traces made. The labels are detailed in [@picautSmartphoneBasedCrowdSourcedDatabase2021]. 
The preliminary work presented here focuses on the analysis of the proportion of 
certain labels in the global sample at certain temporalities.

In addition to data from the collaborative collection, some additional data were 
used to limit the study area. First we chose to limit the geographical scope of this 
preliminary study to metropolitan France because this area contains the largest 
number of recordings and it avoided us to face the problems of time zones.
Then we extended some analysis worldwide.

To facilitate the reproducibility of spatial filtering, it was decided to use 
open data sets from recognized sources: the Natural Earth database 
[@pattersonNaturalEarth2021] and the Admin Express database from the French
National Institute of Geographic and Forest Information [@institutgeographiquenationalAdminExpress].

The raw data has been stored and pre-filtered in a geospatial database and has been
analysed using a statistical analysis language.

### Tools

In order to be as open as possible and to work in the most collaborative way,
we decided a FOSS toolset: PostGreSQL/Postgis to store the data and the R language 
to analyse and produce knowledge from it.
We also used Git as it is a great tool to facilitate remote collaboration.

#### PostGIS

The data are provided as a dump from a PostGreSQL/PostGIS database [@paulramseyPostGIS2001].
Several scripts perform much of the attribute and spatial filtering. 
These filterings are saved in a materialized view.
This view is the entry point for the R language.

#### R

The R language [@rcoreteamRLanguageStatistical2021]
is a programming language for data processing and statistics with many libraries 
dedicated to geospatial data. 
 
The use of Rmarkdown is one of the recommended means for literate programming (along with Jupyter Notebooks and Emacs Org-Mode [@desquilbet2019ReproducibleResearch])

R allowed us to query the database to get data, refine it to our needs, then produce
data analysis and graphs.
Rmarkdown allows to mix code in several programming languages and text in markdown for the dynamic production of 
graphs, tables and documents.
So it is a great tool to either communicate inside our team and publish our results.


Rmarkdown, as any markdown file, is a plain text file that can be easily versionned
with any version control system.
As our team is scaterred in several places in France, we needed a tool to 
facilitate code sources communication, for this purpose, we used git.

#### Git

Git is a Distributed Version Control System (DVCS) [@chacon2014pro]. 
It enables collaborative and decentralized work.
The choice of Git was natural as different collaborators are present on several
sites (Nantes, Lyon, Paris) and Git is already used within the UMRAE laboratory.

### Implementation
The data are provided in the form of a PostGreSQL/PostGIS dump. 
A server has been set up accordingly to the documentation provided and the data loaded.  
A materialized view was created in order to provide a stable access to the data 
corresponding to the defined criteria. 

These criteria are both attributive and spatial. 
We removed from the analysis the tracks taggued *test* or *indoor* as we wanted outdoor recording. 
Short tracks (duration less than 5 seconds) and long tracks (duration longer than 15 minutes)
have been removed. 
We kept the tracks where the GPS median accuracy was less than 20 meters. 
We decided to keep tracks that are comprised in a rather small area, 
the bounding box area of the track should be less than 625 square meters which 
corresponds to a square of 25 by 25 meters.

To extract data regarding France area, we pre-filtered the data
using the NaturalEarth dataset to keep tracks that are within the France country.
This spatial filtering was implemented by creating a materialized view within the 
PostGIS database.
The materialized view is a good compromise between a table and a view because it
has similar response time to a table and also allows us to recompute 
values easily if the threshold values changed.

NaturalEarth is a great dataset and is well known worldwide however it does not
distinguish France metropolitan area from overseas areas.
This could have introduce complications with timezone handling.

Plus we wanted to be able see if seasons have distinct dynamics.
Metropolitan France has a temperate climate [@ClimatFranceMetropolitaine] 
where the climate in the West Indies, Reunion, New Caledonia and Polynesia is of
the tropical maritime type [@ClimatsOutremerMeteoFrance].
That motivated our need to separate overseas records from metropolitan ones

In order to facilitate the replication of the study on areas without this kind 
of issues, this as not been done within the database but at the begining of the 
Rmarkdown document where analysis is conducted.

The code producing the analysis and the graphics presented here are separated in several complementary documents[^5].

[^5]: https://nicolas-roelandt.github.io/lasso-data-analysis/articles/temporal_exploratory_analysis.html

The Rmarkdown document establishes the connection with the materialized view and then 
performs the operations allowing to finalize data preparation and analyze the data.
It is a document mixing narrative, figures and code (in R but also several programming languages).

In this document, we refine the spatial filtering to France's metropolitan area 
using an authoritative dataset [@institutgeographiquenationalAdminExpress].
We also transform the track timestamp to local time and compute seasons using the R packages 
`lubridate` from the `tidyverse` metapackage [@wickhamWelcomeTidyverse2019] and 
`hydroTSM` [@mauriciozambrano-bigiariniHydroTSMTimeSeries2020].

We also used the `suncalc` package (@thieurmelSuncalcComputeSun2019) to compute 
the sunrise time of the day of the track at its location.

# Results
## Environmental acoustics results 

The main goal of this preliminary study was to verify the scientific value of 
crowdsourced acoustic data and if tags are sufficients to describe user environment.

The study concerns tracks bearing a tag, recorded in metropolitan France. 
It focuses on the proportion of a certain tag in relation to all the tags for a 
given period (time of day, season, etc.). 
In the sample studied, it is possible to note a large prevalence of the  *road* tag as shown in Figure \@ref(fig:tag-representation). 
*chatting*, *animals* and *wind* tags are also well represented.

```{r tag-representation, fig.cap="Tag representation in mainland France"}
knitr::include_graphics("plots/tags_repartition.png")
```

Noise pollution due to road noise is a major concern in France.

### Acoustic dynamics of bird song and commutes

A first axis of analysis concerns the time distribution of the tags. 
Animal noises (tag *animals*) are more frequent in the morning and especially 
one hour after sunrise.
This is a well known dynamic for bird song [@robbins1981effect]
and our data shows a similar effect.

<!--TODO: Remplacer par le graphique de Ludovic -->
```{r, fig.cap="Animals dynamics"}
knitr::include_graphics("plots/Repartition_of_animals_sounds_in_local_time.png")
```

We also observed peaks in human activity, especially commuting.
Although we find a difference from commuting times shown by @MA2017135, with a rise from 8 am and a peak around 2 pm.

<!--TODO: Remplacer par le graphique de Ludovic -->
```{r, fig.cap="Road dynamics"}
knitr::include_graphics("plots/Repartition_of_road_sounds_in_local_time.png")
```

Seeing those dynamics was a good sign regarding the validity of crowdsourced 
environmental acoustic data. 
However, we wanted more precise quality indicators so we looked if we were able 
to correlate the mention of physical events in the dataset and records of thoses
events in an authoritative database.

### Correlation between tags and physical events in the user environment

As we know the user position and we have the timestamp of the recording, we are 
able to determine the weather conditions at that time and place using the services
of Météo-France, the French national meteorological service.

<!--TODO: Introduire les graphes et le texte de Ludovic -->

## Benefits of OpenScience and literate programming

allowed the resumption and 
continuation of the analyses shown here. 


# Conclusion
The first results are encouraging because road dynamics related to commuting or 
animal activity can be observed.
The main question was to determine if these known dynamics in environmental acoustics 
can be observed in a crowdsourced dataset.
The first elements seem to answer positively to this question.

Some questions still need to be explored, notably those concerning the 
representativeness of samples that are sometimes weak for certain time periods.

The systematic use of open source software, the provision of documented code files 
and a document mixing narrative, figures and code have allowed the resumption and
continuation of the analyses shown here. 
This work in progress will complete the final article.

# References {-}
